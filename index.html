<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule a Callback</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Optional: Extend Tailwind theme for Inter font if not default
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Inter Font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Force dark mode for native browser elements (like date picker dropdowns) */
        :root {
            color-scheme: dark;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f3f4f6; /* text-gray-100 */
            margin: 0; 
            padding: 1rem; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; 
            box-sizing: border-box;
        }
        .input-icon-group {
            position: relative;
        }
        .input-icon-group .icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af; /* gray-400 */
        }
        .input-icon-group input[type="date"],
        .input-icon-group input[type="time"] {
            padding-left: 2.5rem;
        }
        
        /* Fix for calendar icon color in dark mode inputs */
        ::-webkit-calendar-picker-indicator {
            filter: invert(1);
            opacity: 0.6;
            cursor: pointer;
        }

        .message-area {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            width: 100%;
            max-width: 480px; 
            box-sizing: border-box;
        }
        .message-area.hidden {
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
            height: 0;
            margin-bottom: 0;
            overflow: hidden;
        }
         .message-area.visible {
            opacity: 1;
            transform: translateY(0);
            height: auto; 
            margin-bottom: 1rem; 
        }
        .form-container {
            width: 100%;
            max-width: 480px; 
        }
    </style>
</head>
<body class="antialiased">

    <div class="form-container">
        <!-- Message Area for notifications -->
        <div id="messageArea" class="message-area hidden mb-4 p-3 rounded-lg text-white text-sm font-medium shadow-md">
            <!-- Messages will be injected here by JavaScript -->
        </div>

        <!-- Main Card: Changed to bg-gray-800, added dark border -->
        <div class="bg-gray-800 p-6 sm:p-8 rounded-xl shadow-lg border border-gray-700">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-100 mb-6 text-center">Schedule a Callback</h1>

            <!-- Scheduling Form -->
            <form id="scheduleFormElement"> 
                <div class="space-y-5">
                    <!-- Date and Time Inputs -->
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-300 mb-1">Date and Time</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="input-icon-group">
                                <svg class="icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                <!-- Input: bg-gray-700, border-gray-600, text-gray-100 -->
                                <input type="date" id="date" name="date" required class="w-full px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-gray-100 placeholder-gray-400">
                            </div>
                            <div class="input-icon-group">
                                <svg class="icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <input type="time" id="time" name="time" required class="w-full px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-gray-100 placeholder-gray-400">
                            </div>
                        </div>
                    </div>

                    <!-- Callback Phone Number Choice -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Callback Phone Number</label>
                        <div class="space-y-2 sm:space-y-0 sm:flex sm:space-x-4">
                            <div class="flex items-center">
                                <!-- Radio inputs don't need much styling, usually adapt to OS, but border color helps -->
                                <input id="thisNumber" name="callbackNumberType" type="radio" value="this" checked class="h-4 w-4 text-indigo-500 border-gray-600 bg-gray-700 focus:ring-indigo-500 rounded">
                                <label for="thisNumber" class="ml-2 block text-sm text-gray-300">This Phone Number</label>
                            </div>
                            <div class="flex items-center">
                                <input id="alternateNumber" name="callbackNumberType" type="radio" value="alternate" class="h-4 w-4 text-indigo-500 border-gray-600 bg-gray-700 focus:ring-indigo-500 rounded">
                                <label for="alternateNumber" class="ml-2 block text-sm text-gray-300">Alternate Phone Number</label>
                            </div>
                        </div>
                    </div>

                    <!-- Alternate Phone Number Input (Initially Hidden) -->
                    <div id="alternateNumberInputDiv" class="hidden space-y-1">
                        <label for="alternatePhoneNumber" class="block text-sm font-medium text-gray-300">Alternate Phone Number</label>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <select id="countryCode" name="countryCode" class="sm:w-1/3 px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-gray-100">
                                <option value="+44" selected>UK (+44)</option>
                                <option value="+1">USA (+1)</option>
                                <option value="+33">France (+33)</option>
                                <option value="+49">Germany (+49)</option>
                                <option value="+81">Japan (+81)</option>
                            </select>
                            <input type="tel" id="alternatePhoneNumber" name="alternatePhoneNumber" placeholder="Enter phone number" class="flex-grow px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-gray-100 placeholder-gray-400">
                        </div>
                    </div>

                    <!-- Schedule Button -->
                    <div>
                        <button type="submit" id="scheduleButton" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition duration-150 ease-in-out">
                            Schedule Callback
                        </button>
                    </div>
                </div>
            </form>

            <!-- Scheduled Message Display (Initially Hidden) -->
            <div id="scheduledMessageDisplay" class="hidden mt-6 text-center">
                <!-- Success Box: Dark Green theme -->
                <div class="bg-green-900/30 border border-green-700 p-4 rounded-lg">
                    <p class="text-green-300 text-sm">Callback successfully scheduled for: <strong id="scheduledDateTimeText" class="font-semibold text-green-100"></strong></p>
                    <p class="text-green-300 text-sm mt-1">Phone: <strong id="scheduledPhoneNumberText" class="font-semibold text-green-100"></strong></p>
                </div>
                <button id="rescheduleButton" class="mt-4 bg-gray-700 hover:bg-gray-600 text-gray-200 font-semibold py-2 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition duration-150 ease-in-out text-sm border border-gray-600">
                    Reschedule
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- IMPORTANT: CONFIGURE YOUR CLOUD FUNCTION URL ---
            const CLOUD_FUNCTION_URL = 'https://us-central1-ujet-demo-credit-9gde.cloudfunctions.net/gcpteam-scheduled-callback-function'; 

            // DOM Elements
            const scheduleFormDiv = document.getElementById('scheduleFormElement').parentElement.parentElement; 
            const scheduleFormElement = document.getElementById('scheduleFormElement');
            const scheduledMessageDisplay = document.getElementById('scheduledMessageDisplay');
            const dateInput = document.getElementById('date');
            const timeInput = document.getElementById('time');
            const callbackNumberTypeRadios = document.querySelectorAll('input[name="callbackNumberType"]');
            const alternateNumberInputDiv = document.getElementById('alternateNumberInputDiv');
            const countryCodeSelect = document.getElementById('countryCode');
            const alternatePhoneNumberInput = document.getElementById('alternatePhoneNumber');
            const scheduleButton = document.getElementById('scheduleButton');
            const rescheduleButton = document.getElementById('rescheduleButton');
            const scheduledDateTimeText = document.getElementById('scheduledDateTimeText');
            const scheduledPhoneNumberText = document.getElementById('scheduledPhoneNumberText');
            const messageArea = document.getElementById('messageArea');

            function showMessage(message, type = 'error') {
                messageArea.textContent = message;
                messageArea.classList.remove('hidden', 'bg-red-500', 'bg-red-900/80', 'bg-green-500', 'bg-green-900/80', 'bg-blue-500', 'opacity-0', 'translate-y-[-10px]', 'pointer-events-none');
                messageArea.classList.add('visible');

                // Using slightly transparent backgrounds for dark mode aesthetics
                if (type === 'error') {
                    messageArea.classList.add('bg-red-900/90', 'border', 'border-red-700', 'text-red-100');
                } else if (type === 'success') {
                    messageArea.classList.add('bg-green-900/90', 'border', 'border-green-700', 'text-green-100');
                } else {
                    messageArea.classList.add('bg-blue-900/90', 'border', 'border-blue-700', 'text-blue-100');
                }
                
                // Auto-hide message
                setTimeout(() => {
                    messageArea.classList.remove('visible');
                    messageArea.classList.add('opacity-0', 'translate-y-[-10px]', 'pointer-events-none');
                    setTimeout(() => {
                        messageArea.classList.add('hidden');
                        messageArea.className = 'message-area hidden mb-4 p-3 rounded-lg text-white text-sm font-medium shadow-md'; // Reset base classes
                    }, 300); 
                }, 5000);
            }

            callbackNumberTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'alternate') {
                        alternateNumberInputDiv.classList.remove('hidden');
                    } else {
                        alternateNumberInputDiv.classList.add('hidden');
                    }
                });
            });

            scheduleFormElement.addEventListener('submit', async function(event) {
                event.preventDefault(); 

                if (CLOUD_FUNCTION_URL === 'https://us-central1-ujet-demo-credit-9gde.cloudfunctions.net/gcpteam-scheduled-callback-function') {
                    // This warning is fine if that IS your real URL, but usually it's a placeholder.
                    // Given the user prompt specifically included this URL, we assume it is correct.
                }

                messageArea.classList.add('hidden', 'opacity-0'); 

                const dateValue = dateInput.value;
                const timeValue = timeInput.value;
                const selectedCallbackType = document.querySelector('input[name="callbackNumberType"]:checked').value;
                let callbackNumber;

                if (!dateValue || !timeValue) {
                    showMessage('Please select both date and time.', 'error');
                    return;
                }

                if (selectedCallbackType === 'alternate') {
                    const countryCode = countryCodeSelect.value;
                    const phoneNumber = alternatePhoneNumberInput.value.trim();
                    if (!phoneNumber) {
                        showMessage('Please enter an alternate phone number.', 'error');
                        alternatePhoneNumberInput.focus();
                        return;
                    }
                    if (!/^\d{7,15}$/.test(phoneNumber.replace(/\s+/g, ''))) {
                         showMessage('Please enter a valid phone number (7-15 digits).', 'error');
                         alternatePhoneNumberInput.focus();
                         return;
                    }
                    callbackNumber = countryCode + phoneNumber;
                } else {
                    callbackNumber = '+16477627687'; 
                }

                const scheduledDateTime = `${dateValue}T${timeValue}:00.000Z`;

                scheduleButton.disabled = true;
                scheduleButton.textContent = 'Scheduling...';
                scheduleButton.classList.add('opacity-75', 'cursor-not-allowed');

                try {
                    const response = await fetch(CLOUD_FUNCTION_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ scheduledDateTime, callbackNumber })
                    });

                    let data;
                    const contentType = response.headers.get("content-type");
                    if (contentType && contentType.indexOf("application/json") !== -1) {
                        data = await response.json();
                    } else {
                        const textResponse = await response.text();
                        data = { error: `Server returned non-JSON response: ${textResponse.substring(0,100)}...` };
                        if (!response.ok) {
                           throw new Error(data.error || `HTTP error! status: ${response.status}`);
                        }
                    }
                    
                    if (response.ok) {
                        showMessage('Callback scheduled successfully!', 'success');
                        scheduledDateTimeText.textContent = new Date(scheduledDateTime).toLocaleString();
                        scheduledPhoneNumberText.textContent = callbackNumber;
                        scheduleFormElement.parentElement.classList.add('hidden'); // Hide the form container
                        scheduleFormElement.style.display = 'none'; // Explicitly hide form
                        scheduledMessageDisplay.classList.remove('hidden');
                        // Show the parent wrapper of the success message
                        document.querySelector('.bg-gray-800').appendChild(scheduledMessageDisplay);
                        
                        console.log('Callback scheduled successfully:', data);
                    } else {
                        throw new Error(data.error || `HTTP error! status: ${response.status}`);
                    }
                } catch (error) {
                    showMessage('Error: ' + error.message, 'error');
                    console.error('Fetch error:', error);
                } finally {
                    scheduleButton.disabled = false;
                    scheduleButton.textContent = 'Schedule Callback';
                    scheduleButton.classList.remove('opacity-75', 'cursor-not-allowed');
                }
            });

            rescheduleButton.addEventListener('click', function() {
                scheduledMessageDisplay.classList.add('hidden');
                scheduleFormElement.style.display = 'block'; // Show form again
                scheduleFormElement.parentElement.classList.remove('hidden');
                messageArea.classList.add('hidden', 'opacity-0');
                scheduleFormElement.reset(); 
                document.getElementById('thisNumber').checked = true;
                alternateNumberInputDiv.classList.add('hidden');
            });

            const today = new Date();
            const minDate = today.toISOString().split('T')[0];
            dateInput.setAttribute('min', minDate);
        });
    </script>
</body>
</html>
